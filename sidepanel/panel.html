<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TabKebab</title>
  <link rel="stylesheet" href="panel.css">
</head>
<body>
  <header class="app-header">
    <svg class="logo" width="24" height="24" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
      <!-- Skewer stick -->
      <rect x="58" y="10" width="12" height="100" rx="6" fill="currentColor"/>
      <polygon points="58,104 70,104 64,120" fill="currentColor"/>
      <circle cx="64" cy="10" r="8" fill="currentColor"/>
      <circle cx="64" cy="10" r="4" fill="#ef4444"/>
      <!-- Tab chunk 1 — red -->
      <g transform="rotate(-3, 64, 30)">
        <rect x="32" y="20" width="64" height="20" rx="7" fill="#ef4444"/>
      </g>
      <!-- Tab chunk 2 — amber -->
      <g transform="rotate(2, 64, 54)">
        <rect x="34" y="44" width="60" height="20" rx="7" fill="#f59e0b"/>
      </g>
      <!-- Tab chunk 3 — teal -->
      <g transform="rotate(-2, 64, 78)">
        <rect x="36" y="68" width="56" height="20" rx="7" fill="#14b8a6"/>
      </g>
      <!-- Tab chunk 4 — purple -->
      <g transform="rotate(1, 64, 98)">
        <rect x="40" y="90" width="48" height="16" rx="6" fill="#8b5cf6"/>
      </g>
    </svg>
    <h1>TabKebab</h1>
    <button id="btn-help" class="settings-btn" aria-label="Help" title="Help (?)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
        <line x1="12" y1="17" x2="12.01" y2="17"/>
      </svg>
    </button>
    <button id="btn-settings" class="settings-btn" aria-label="Settings" title="Settings">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
      </svg>
    </button>
  </header>

  <nav class="tab-nav" role="tablist">
    <button role="tab" data-view="windows" aria-selected="false">Windows</button>
    <button role="tab" data-view="tabs" class="active" aria-selected="true">Tabs</button>
    <button role="tab" data-view="stash" aria-selected="false">Stash</button>
    <button role="tab" data-view="sessions" aria-selected="false">Sessions</button>
  </nav>

  <main class="view-container">
    <!-- AI Command Bar -->
    <div id="command-bar" class="command-bar" hidden>
      <div class="command-bar-row">
        <input type="text" id="ai-command-input" class="input" placeholder="Ask AI... (e.g., 'close YouTube tabs')">
        <button id="btn-ai-command" class="action-btn">Go</button>
      </div>
      <div id="command-results" class="command-results"></div>
    </div>

    <!-- Sessions view -->
    <section id="view-sessions" class="view hidden">
      <div class="toolbar">
        <input type="text" id="session-name" placeholder="Session name..." class="input">
        <button id="btn-save-session" class="action-btn">Save</button>
      </div>
      <div id="session-list" class="session-list"></div>
      <div class="toolbar" style="margin-top: 12px;">
        <button id="btn-export" class="action-btn secondary">Export JSON</button>
        <label class="action-btn secondary file-label">
          Import JSON
          <input type="file" id="btn-import" accept=".json" hidden>
        </label>
      </div>
    </section>

    <!-- Windows view -->
    <section id="view-windows" class="view hidden">
      <div class="window-stats-bar">
        <div class="stat-card">
          <div class="stat-value" id="stat-windows">0</div>
          <div class="stat-label">Windows</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-tabs">0</div>
          <div class="stat-label">Tabs</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-avg">0</div>
          <div class="stat-label">Avg/Window</div>
        </div>
      </div>
      <div class="toolbar">
        <button id="btn-consolidate-windows" class="action-btn">Consolidate Windows</button>
        <button id="btn-collapse-all" class="action-btn secondary">Collapse All</button>
        <button id="btn-expand-all" class="action-btn secondary">Expand All</button>
      </div>
      <div id="consolidation-progress" class="pipeline-progress">
        <div class="phase-label">
          <span class="phase-badge" id="consolidation-phase">SNAPSHOT</span>
          <span id="consolidation-title">Scanning windows...</span>
        </div>
        <div class="phase-detail" id="consolidation-detail"></div>
        <div class="progress-bar">
          <div class="progress-bar-fill indeterminate" id="consolidation-fill"></div>
        </div>
      </div>
      <div id="window-list"></div>
    </section>

    <!-- Stash view -->
    <section id="view-stash" class="view hidden">
      <div id="stash-list" class="stash-list"></div>
      <div class="toolbar" style="margin-top: 12px;">
        <button id="btn-export-stashes" class="action-btn secondary">Export Stashes</button>
        <label class="action-btn secondary file-label">
          Import Stashes
          <input type="file" id="btn-import-stashes" accept=".json" hidden>
        </label>
      </div>
    </section>

    <!-- Tabs view (with sub-tabs: Domains, Groups, Duplicates) -->
    <section id="view-tabs" class="view active">
      <nav class="sub-nav" role="tablist">
        <button role="tab" data-subtab="domains" class="active" aria-selected="true">Domains</button>
        <button role="tab" data-subtab="groups" aria-selected="false">Groups</button>
        <button role="tab" data-subtab="duplicates" aria-selected="false">Duplicates</button>
      </nav>

      <!-- Domains sub-view -->
      <div id="sub-domains" class="sub-view">
        <div class="toolbar">
          <button id="btn-group-by-domain" class="action-btn">Group by Domain</button>
          <button id="btn-smart-group" class="action-btn" hidden>Smart Group</button>
          <button id="btn-ungroup-all" class="action-btn secondary">Ungroup All</button>
          <button id="btn-kebab-all" class="action-btn kebab">Kebab All</button>
          <button id="btn-collapse-all-tabs" class="action-btn secondary">Collapse All</button>
          <button id="btn-expand-all-tabs" class="action-btn secondary">Expand All</button>
        </div>
        <div id="pipeline-progress" class="pipeline-progress">
          <div class="phase-label">
            <span class="phase-badge" id="progress-phase">SNAPSHOT</span>
            <span id="progress-title">Reading tabs...</span>
          </div>
          <div class="phase-detail" id="progress-detail"></div>
          <div class="progress-bar">
            <div class="progress-bar-fill indeterminate" id="progress-fill"></div>
          </div>
        </div>
        <div id="tab-list" class="tab-list"></div>
      </div>

      <!-- Groups sub-view -->
      <div id="sub-groups" class="sub-view hidden">
        <h3 class="section-title section-collapsible" id="section-chrome-groups"><span class="section-chevron">&#x25bc;</span> Chrome Tab Groups</h3>
        <div id="chrome-groups-container" class="chrome-groups"></div>

        <h3 class="section-title section-collapsible" id="section-custom-groups"><span class="section-chevron">&#x25bc;</span> Custom Groups</h3>
        <div id="custom-groups-content">
          <div class="toolbar">
            <input type="text" id="new-group-name" placeholder="New group name..." class="input">
            <select id="new-group-color" class="input color-select">
              <option value="blue">Blue</option>
              <option value="red">Red</option>
              <option value="yellow">Yellow</option>
              <option value="green">Green</option>
              <option value="pink">Pink</option>
              <option value="purple">Purple</option>
              <option value="cyan">Cyan</option>
              <option value="orange">Orange</option>
            </select>
            <button id="btn-create-group" class="action-btn">Create</button>
          </div>
          <div id="manual-groups-container" class="manual-groups"></div>
        </div>
        <h3 class="section-title section-collapsible" id="section-ungrouped"><span class="section-chevron">&#x25bc;</span> Ungrouped Tabs</h3>
        <div id="ungrouped-tabs" class="tab-list" data-dropzone="ungrouped"></div>
      </div>

      <!-- Duplicates sub-view -->
      <div id="sub-duplicates" class="sub-view hidden">
        <div class="toolbar">
          <button id="btn-scan-dupes" class="action-btn">Scan for Duplicates</button>
          <button id="btn-close-all-dupes" class="action-btn danger" disabled>Close All Duplicates</button>
        </div>
        <div id="duplicate-list" class="duplicate-list">
          <p class="empty-state">Click "Scan" to find duplicate tabs.</p>
        </div>
      </div>
    </section>

    <!-- Settings view -->
    <section id="view-settings" class="view hidden">

      <!-- ─── General Settings ─── -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
          <h3 class="settings-card-title">General</h3>
        </div>
        <div class="settings-card-body">
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Remove stash after restore</span>
              <span class="setting-hint">Automatically delete stash entries once restored</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-removeStashAfterRestore" data-setting="removeStashAfterRestore">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Default view</span>
              <span class="setting-hint">Which view opens when you launch the panel</span>
            </div>
            <select id="setting-defaultView" class="setting-select" data-setting="defaultView">
              <option value="tabs">Tabs</option>
              <option value="windows">Windows</option>
              <option value="stash">Stash</option>
              <option value="sessions">Sessions</option>
            </select>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Theme</span>
              <span class="setting-hint">Choose light, dark, or follow system preference</span>
            </div>
            <select id="setting-theme" class="setting-select" data-setting="theme">
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div class="setting-divider"></div>
          <div class="toolbar">
            <button id="btn-export-settings" class="action-btn secondary">Export Settings</button>
            <label class="action-btn secondary file-label">
              Import Settings
              <input type="file" id="btn-import-settings" accept=".json" hidden>
            </label>
          </div>
        </div>
      </div>

      <!-- ─── Tab Limits ─── -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
          <h3 class="settings-card-title">Tab Limits</h3>
        </div>
        <div class="settings-card-body">
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Warning threshold (yellow)</span>
              <span class="setting-hint">Tabs per window before yellow warning</span>
            </div>
            <input type="number" id="setting-recommendedTabsPerWindow" class="setting-number" data-setting="recommendedTabsPerWindow" min="1" max="500">
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Danger threshold (red)</span>
              <span class="setting-hint">Tabs per window before red warning</span>
            </div>
            <input type="number" id="setting-maxTabsPerWindow" class="setting-number" data-setting="maxTabsPerWindow" min="1" max="500">
          </div>
        </div>
      </div>

      <!-- ─── Automation ─── -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
          <h3 class="settings-card-title">Automation</h3>
        </div>
        <div class="settings-card-body">
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Auto-save interval</span>
              <span class="setting-hint">Hours between automatic session saves</span>
            </div>
            <div class="setting-number-unit">
              <input type="number" id="setting-autoSaveIntervalHours" class="setting-number" data-setting="autoSaveIntervalHours" min="1" max="168">
              <span class="setting-unit">hrs</span>
            </div>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Auto-save retention</span>
              <span class="setting-hint">Days to keep auto-saved sessions</span>
            </div>
            <div class="setting-number-unit">
              <input type="number" id="setting-autoSaveRetentionDays" class="setting-number" data-setting="autoSaveRetentionDays" min="1" max="365">
              <span class="setting-unit">days</span>
            </div>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Auto-kebab idle tabs</span>
              <span class="setting-hint">Discard tabs idle for this many hours (0 = off)</span>
            </div>
            <div class="setting-number-unit">
              <input type="number" id="setting-autoKebabAfterHours" class="setting-number" data-setting="autoKebabAfterHours" min="0" max="720">
              <span class="setting-unit">hrs</span>
            </div>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Auto-stash inactive tabs</span>
              <span class="setting-hint">Stash and close tabs inactive for this many days (0 = off)</span>
            </div>
            <div class="setting-number-unit">
              <input type="number" id="setting-autoStashAfterDays" class="setting-number" data-setting="autoStashAfterDays" min="0" max="365">
              <span class="setting-unit">days</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ─── Bookmarks ─── -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
          <h3 class="settings-card-title">Bookmarks</h3>
        </div>
        <div class="settings-card-body">
          <p class="setting-section-desc">Choose how tabs are organized when bookmarked. Select multiple formats.</p>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">By Windows</span>
              <span class="setting-hint">TabKebab / date / Windows / Window 1..N / tabs</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-bookmarkByWindows" data-setting="bookmarkByWindows">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">By Groups</span>
              <span class="setting-hint">TabKebab / date / Groups / group name / tabs</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-bookmarkByGroups" data-setting="bookmarkByGroups">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">By Domains</span>
              <span class="setting-hint">TabKebab / date / Domains / domain / tabs</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-bookmarkByDomains" data-setting="bookmarkByDomains">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-divider"></div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Destination</span>
              <span class="setting-hint">Where to save bookmark data</span>
            </div>
            <select id="setting-bookmarkDestination" class="setting-select" data-setting="bookmarkDestination">
              <option value="chrome">Chrome Bookmarks</option>
              <option value="indexeddb">Local Storage</option>
              <option value="drive">Google Drive</option>
              <option value="all">All destinations</option>
            </select>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Auto-bookmark on stash</span>
              <span class="setting-hint">Automatically create bookmarks when stashing tabs</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-autoBookmarkOnStash" data-setting="autoBookmarkOnStash">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">Compressed export</span>
              <span class="setting-hint">Compress bookmark exports to save space</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-compressedExport" data-setting="compressedExport">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <span class="setting-label">HTML bookmarks to Drive</span>
              <span class="setting-hint">Upload a browsable HTML page with search to Google Drive alongside JSON</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="setting-exportHtmlBookmarkToDrive" data-setting="exportHtmlBookmarkToDrive">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="setting-divider"></div>
          <div class="toolbar">
            <button id="btn-bookmark-now" class="action-btn secondary">Bookmark Now</button>
          </div>
        </div>
      </div>

      <!-- ─── Google Drive ─── -->
      <div class="settings-section settings-card" id="settings-drive-section">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>
          <h3 class="settings-card-title">Google Drive</h3>
        </div>
        <div class="settings-card-body">
          <p class="setting-section-desc">Backup data to Google Drive under TabKebab / sessions, stashes, bookmarks subfolders.</p>
          <div id="drive-status" class="drive-status">Not connected</div>
          <div class="toolbar" style="margin-top: 8px;">
            <button id="btn-connect-drive" class="action-btn">Connect Google Drive</button>
            <button id="btn-sync-now" class="action-btn secondary" disabled>Sync Now</button>
          </div>
          <button id="btn-disconnect-drive" class="action-btn danger" hidden style="margin-top: 8px;">Disconnect</button>

          <div id="drive-settings-connected" class="drive-connected-settings" hidden>
            <div class="setting-divider"></div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Auto-export sessions</span>
                <span class="setting-hint">Push sessions to Drive on sync</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-autoExportSessionsToDrive" data-setting="autoExportSessionsToDrive">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Auto-export stashes</span>
                <span class="setting-hint">Push stashes to Drive on sync</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-autoExportStashesToDrive" data-setting="autoExportStashesToDrive">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Auto-sync interval</span>
                <span class="setting-hint">Hours between automatic Drive syncs (0 = manual)</span>
              </div>
              <div class="setting-number-unit">
                <input type="number" id="setting-autoSyncToDriveIntervalHours" class="setting-number" data-setting="autoSyncToDriveIntervalHours" min="0" max="168">
                <span class="setting-unit">hrs</span>
              </div>
            </div>
            <div class="setting-row" id="drive-retention-row">
              <div class="setting-info">
                <span class="setting-label">Drive retention</span>
                <span class="setting-hint">Auto-delete Drive files older than this</span>
              </div>
              <div class="setting-number-unit">
                <input type="number" id="setting-driveRetentionDays" class="setting-number" data-setting="driveRetentionDays" min="1" max="365">
                <span class="setting-unit">days</span>
              </div>
            </div>
            <div class="setting-row">
              <div class="setting-info">
                <span class="setting-label">Never delete from Drive</span>
                <span class="setting-hint">Override retention and keep all files forever</span>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="setting-neverDeleteFromDrive" data-setting="neverDeleteFromDrive">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <button id="btn-undo-drive-settings" class="action-btn secondary" hidden
                    style="margin-bottom: 8px;">Undo Last Settings Import</button>
            <div class="setting-divider"></div>
            <div class="toolbar">
              <input type="number" id="drive-cleanup-days" class="setting-number" value="30" min="1" max="365" style="width: 64px; flex: 0;">
              <button id="btn-clean-drive" class="action-btn secondary">Clean Drive Files</button>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Settings -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a4 4 0 0 1 4 4v1a1 1 0 0 0 1 1h1a4 4 0 0 1 0 8h-1a1 1 0 0 0-1 1v1a4 4 0 0 1-8 0v-1a1 1 0 0 0-1-1H6a4 4 0 0 1 0-8h1a1 1 0 0 0 1-1V6a4 4 0 0 1 4-4z"/></svg>
          <h3 class="settings-card-title">AI Features</h3>
        </div>
        <div class="settings-card-body">
        <p class="description">Enable AI-powered smart grouping, tab summaries, and natural language commands. Your API keys are encrypted and stored locally.</p>

        <label class="ai-toggle">
          <input type="checkbox" id="ai-enabled">
          <span>Enable AI Features</span>
        </label>

        <div id="ai-config" class="ai-config" hidden>
          <label class="input-label">AI Provider</label>
          <select id="ai-provider" class="input" style="margin-bottom: 12px;">
            <option value="">Select a provider...</option>
            <option value="openai">OpenAI (GPT)</option>
            <option value="claude">Claude (Anthropic)</option>
            <option value="gemini">Google Gemini</option>
            <option value="chrome-ai">Chrome Built-in AI (Experimental)</option>
            <option value="custom">Custom (OpenAI-Compatible)</option>
          </select>

          <!-- OpenAI config -->
          <div id="ai-config-openai" class="provider-config" hidden>
            <label class="input-label">API Key</label>
            <div class="toolbar" style="margin-bottom: 8px;">
              <input type="password" id="openai-api-key" class="input" placeholder="sk-...">
              <button id="btn-toggle-openai-key" class="action-btn secondary" style="flex:0">Show</button>
            </div>
            <label class="input-label">Model</label>
            <div class="toolbar" style="margin-bottom: 12px;">
              <select id="openai-model" class="input">
                <option value="gpt-4.1-nano">GPT-4.1 Nano (fastest)</option>
                <option value="gpt-4.1-mini">GPT-4.1 Mini</option>
                <option value="gpt-4.1">GPT-4.1</option>
                <option value="gpt-5-mini">GPT-5 Mini</option>
                <option value="gpt-5.2">GPT-5.2</option>
                <option value="o4-mini">o4-mini (reasoning)</option>
              </select>
              <button class="action-btn secondary btn-load-models" data-provider="openai" style="flex:0">Load</button>
            </div>
          </div>

          <!-- Claude config -->
          <div id="ai-config-claude" class="provider-config" hidden>
            <label class="input-label">API Key</label>
            <div class="toolbar" style="margin-bottom: 8px;">
              <input type="password" id="claude-api-key" class="input" placeholder="sk-ant-...">
              <button id="btn-toggle-claude-key" class="action-btn secondary" style="flex:0">Show</button>
            </div>
            <label class="input-label">Model</label>
            <div class="toolbar" style="margin-bottom: 12px;">
              <select id="claude-model" class="input">
                <option value="claude-haiku-4-5">Claude Haiku 4.5 (fastest)</option>
                <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
                <option value="claude-opus-4-5">Claude Opus 4.5</option>
                <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                <option value="claude-opus-4-20250514">Claude Opus 4</option>
              </select>
              <button class="action-btn secondary btn-load-models" data-provider="claude" style="flex:0">Load</button>
            </div>
          </div>

          <!-- Gemini config -->
          <div id="ai-config-gemini" class="provider-config" hidden>
            <label class="input-label">API Key</label>
            <div class="toolbar" style="margin-bottom: 8px;">
              <input type="password" id="gemini-api-key" class="input" placeholder="AIza...">
              <button id="btn-toggle-gemini-key" class="action-btn secondary" style="flex:0">Show</button>
            </div>
            <label class="input-label">Model</label>
            <div class="toolbar" style="margin-bottom: 12px;">
              <select id="gemini-model" class="input">
                <option value="gemini-2.5-flash">Gemini 2.5 Flash (fastest)</option>
                <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
                <option value="gemini-3-flash-preview">Gemini 3 Flash (preview)</option>
                <option value="gemini-3-pro-preview">Gemini 3 Pro (preview)</option>
              </select>
              <button class="action-btn secondary btn-load-models" data-provider="gemini" style="flex:0">Load</button>
            </div>
          </div>

          <!-- Chrome AI config -->
          <div id="ai-config-chrome-ai" class="provider-config" hidden>
            <p class="description">Chrome Built-in AI uses Gemini Nano on-device. Requires Chrome 138+ with the Prompt API origin trial. No API key needed.</p>
            <div id="chrome-ai-availability" class="drive-status">Checking availability...</div>
          </div>

          <!-- Custom (OpenAI-compatible) config -->
          <div id="ai-config-custom" class="provider-config" hidden>
            <p class="description">Connect to any OpenAI-compatible API: Ollama, LM Studio, vLLM, Together AI, Groq, etc.</p>
            <label class="input-label">Base URL</label>
            <input type="text" id="custom-base-url" class="input" placeholder="http://localhost:11434/v1" style="margin-bottom: 8px;">
            <label class="input-label">API Key (optional)</label>
            <div class="toolbar" style="margin-bottom: 8px;">
              <input type="password" id="custom-api-key" class="input" placeholder="(leave blank if not needed)">
              <button id="btn-toggle-custom-key" class="action-btn secondary" style="flex:0">Show</button>
            </div>
            <label class="input-label">Model</label>
            <div class="toolbar" style="margin-bottom: 12px;">
              <select id="custom-model" class="input">
                <option value="default">default</option>
              </select>
              <button class="action-btn secondary btn-load-models" data-provider="custom" style="flex:0">Load</button>
            </div>
          </div>

          <!-- Passphrase -->
          <div class="passphrase-area">
            <label class="ai-toggle">
              <input type="checkbox" id="ai-passphrase-enabled">
              <span>Protect API key with passphrase</span>
            </label>
            <div id="ai-passphrase-section" class="passphrase-section" hidden>
              <p class="description">You'll need to enter this passphrase once per browser session to unlock AI features.</p>
              <input type="password" id="ai-passphrase" class="input" placeholder="Enter passphrase...">
            </div>
          </div>

          <!-- Actions -->
          <div class="toolbar">
            <button id="btn-test-ai" class="action-btn secondary">Test Connection</button>
            <button id="btn-save-ai" class="action-btn">Save Settings</button>
          </div>

          <div id="ai-test-result" class="drive-status" hidden></div>

          <div class="toolbar" style="margin-top: 12px;">
            <button id="btn-clear-ai-cache" class="action-btn secondary">Clear AI Cache</button>
          </div>
        </div>
        </div>
      </div>

      <!-- Tab Sleep (Kebab) -->
      <div class="settings-section settings-card">
        <div class="settings-card-header">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 18a5 5 0 0 0-10 0"/><line x1="12" y1="2" x2="12" y2="9"/><line x1="4.22" y1="10.22" x2="5.64" y2="11.64"/><line x1="1" y1="18" x2="3" y2="18"/><line x1="21" y1="18" x2="23" y2="18"/><line x1="18.36" y1="11.64" x2="19.78" y2="10.22"/></svg>
          <h3 class="settings-card-title">Tab Sleep (Kebab)</h3>
        </div>
        <div class="settings-card-body">
          <p class="setting-section-desc">Domains in the keep-awake list are never discarded when you "Kebab" tabs.</p>

          <div class="toolbar" style="margin-bottom: 8px;">
            <input type="text" id="keep-awake-domain-input" class="input" placeholder="Add domain (e.g. slack.com)">
            <button id="btn-add-keep-awake" class="action-btn secondary">Add</button>
          </div>

          <div id="keep-awake-domain-list" class="keep-awake-domain-list"></div>

          <div class="toolbar" style="margin-top: 8px;">
            <button id="btn-suggest-keep-awake" class="action-btn secondary ai-feature" hidden>Suggest (AI)</button>
            <button id="btn-reset-keep-awake" class="action-btn secondary">Reset to Defaults</button>
          </div>

          <div id="keep-awake-suggestions" class="keep-awake-suggestions" hidden></div>
        </div>
      </div>

      <!-- ─── About ─── -->
      <div class="settings-section settings-card about-section">
        <div class="settings-card-body" style="text-align:center; padding: 20px 16px;">
          <svg class="about-logo" width="48" height="48" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="58" y="10" width="12" height="100" rx="6" fill="#404040"/>
            <polygon points="58,104 70,104 64,120" fill="#404040"/>
            <circle cx="64" cy="10" r="8" fill="#404040"/>
            <circle cx="64" cy="10" r="4" fill="#ef4444"/>
            <g transform="rotate(-3, 64, 30)"><rect x="32" y="20" width="64" height="20" rx="7" fill="#ef4444"/></g>
            <g transform="rotate(2, 64, 54)"><rect x="34" y="44" width="60" height="20" rx="7" fill="#f59e0b"/></g>
            <g transform="rotate(-2, 64, 78)"><rect x="36" y="68" width="56" height="20" rx="7" fill="#14b8a6"/></g>
            <g transform="rotate(1, 64, 98)"><rect x="40" y="90" width="48" height="16" rx="6" fill="#8b5cf6"/></g>
          </svg>
          <div class="about-title">TabKebab</div>
          <div class="about-version">v1.0.0</div>
          <div class="about-credit">Created by <strong>Michel Abboud</strong></div>
          <div class="about-ai-credit">Built with the assistance of AI (Claude by Anthropic)</div>
          <div class="about-links">
            <a href="https://github.com/michelabboud/tabkebab-chrome-ext/blob/main/PRIVACY.md" target="_blank" rel="noopener">Privacy Policy</a>
            <span class="about-sep">|</span>
            <a href="https://github.com/michelabboud/tabkebab-chrome-ext/blob/main/TERMS.md" target="_blank" rel="noopener">Terms of Service</a>
          </div>
          <div class="about-links">
            <a href="https://github.com/michelabboud/tabkebab-chrome-ext" target="_blank" rel="noopener">GitHub</a>
            <span class="about-sep">|</span>
            <a href="https://github.com/michelabboud/tabkebab-chrome-ext/issues" target="_blank" rel="noopener">Report an Issue</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="confirm-overlay" class="confirm-overlay" hidden></div>
  <div id="toast-container" class="toast-container"></div>

  <script type="module" src="panel.js"></script>
</body>
</html>
